<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Auphonic</title>
	<meta name="viewport" content="initial-scale=1.0 maximum-scale=1.0 user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <style type="text/css">
    .hidden {
      display: none;
    }
  </style>
  <script type="text/javascript">
    (function() {
      this.__CORDOVA_VERSION = '2.1.0';
      this.__API_DOMAIN = 'https://auphonic.com/';
      this.__SERVER_URL = 'https://auphonic.com/mobile/';

      // Update this if you are testing the application locally.
      var DEVbaseURL = '/Thesis/App/';
      // Local test URL for the Server scripts. Remove this when deploying.
      this.__SERVER_URL = 'http://10.201.1.91' + DEVbaseURL + '../Server/';
      if (new RegExp('^' + DEVbaseURL).test(location.pathname)) {
        this.__LOCALHOST__ = true;
        this.__baseURL = DEVbaseURL;
        this.__API_DOMAIN = '../wrapper.php?';
        this.__SERVER_URL = DEVbaseURL + '../Server/';
        document.write('<base href="' + DEVbaseURL + '" />');
      }

      this.__SERVER_URL += this.__CORDOVA_VERSION + '/';

      this.__loadJS = function(url, success, error) {
        var script = document.createElement('script');
        if (success) script.addEventListener('load', success, false);
        if (error) script.addEventListener('error', error, false);
        script.setAttribute('src', url);
        document.querySelector('head').appendChild(script);
      };

      var links = [];
      var timer = null;
      this.__loadCSS = function(url, success, error) {
        var listener = function() {
          link.removeEventListener('load', listener, false);
          link.onreadystatechange = null;
          if (success) success.call(this);
          if (error) link.removeEventListener('error', error, false);
        };

        var link = document.createElement('link');
        link.setAttribute('rel', 'stylesheet');
        link.setAttribute('media', 'all');
        link.setAttribute('type', 'text/css');
        link.setAttribute('href', url);
        link.setAttribute('data-href', url);

        if (error) link.addEventListener('error', error, false);

        if (success) {
          link.addEventListener('load', listener, false);
          link.onreadystatechange = function() {
              var state = link.readyState;
              if (state === 'loaded' || state === 'complete') listener.call(this);
            };
        }

        document.querySelector('head').appendChild(link);
        links.push({element: link, listener: listener});
        if (!timer) timer = setInterval(poll, 20);
      };

      // Fallback polling method for browsers that don't support link.onload
      var poll = function() {
        var sheets = document.styleSheets;
        var i = sheets.length;

        // Cross Origin CSS loading
        // http://yearofmoo.com/2011/03/cross-browser-stylesheet-preloading/
        while (i--) {
          var link = sheets[i];
          var owner = link.ownerNode || link.owningElement;
          var j = links.length;
          if (owner) {
            while (j--) {
              if (owner == links[j].element) {
                links[j].listener.call(links[j].element);
                links.splice(j, 1);
              }
            }
          }
        }

        if (!links.length) {
          clearInterval(timer);
          timer = null;
        }
      };

      this.__loadCSS('App.css');
    }).call(window);
  </script>
  <script type="text/javascript" src="./Spinner.js"></script>
</head>
<body class="chrome-invisible">
  <div id="splash" class="splash"></div>
  <div id="login" class="login hidden"></div>
  <div id="retry" class="retry hidden">
    <a href="#" class="button expand">Retry</a>
  </div>
  <div id="native-notice" class="notice native">
    <div class="notice-inner text">
      <h1>A network error ocurred</h1>
      Please put your device in some elevated position to regain Internet access. If the problem lies on our end we'll make sure to fix the problem quickly :)
    </div>
  </div>
  <script type="text/javascript" src="./cordova.js"></script>
  <script type="text/javascript">
    (function() {
      // We are reusing this instance in App.js once all code has loaded
      var spinner = this.__NATIVE_SPINNER = new Spinner({
        lines: 12,
        length: 10,
        width: 7,
        radius: 13,
        trail: 30,
        color: '#fff'
      });

      var loaded = 0;
      var resources = 2;
      var retryElement = document.querySelector('#retry');
      var noticeElement = document.querySelector('#native-notice');

      var clickRetry = function(event) {
        if (event) event.preventDefault();

        noticeElement.style.display = '';
        retry.className = 'retry hidden';
        retryElement.querySelector('a.button').removeEventListener('click', clickRetry, false);
        load();
      };

      var url = null;

      var load = function() {
        loaded = 0;

        spinner.spin(document.querySelector('#splash'));
        __loadJS(__SERVER_URL + 'Version.js?' + Date.now(), function() {
          // __APP_VERSION is now available
          __loadCSS(__SERVER_URL + 'Style-' + __APP_VERSION + '.css', success, error);
          __loadJS(__SERVER_URL + 'App-' + __APP_VERSION + '.js', success, error);
        }, error);
      };

      var success = function() {
        // We are not stopping the spinner because it is being reused
        if (++loaded >= resources) require('App').boot();
      };

      var error = function() {
        spinner.stop();

        noticeElement.style.display = 'block';
        retryElement.className = 'retry';
        retryElement.querySelector('a.button').addEventListener('click', clickRetry, false);
      };

      load();
    })();
  </script>
</body>
</html>
